<!-- extend from base layout -->
{% extends "templates/site.html" %}

{% block head %}

  <style>

    #container {
      padding: 68px 0 0 0;
    }

    #nav_footer {
      margin: 0 auto;
    }

    .builder_embed {
      margin: 20px;
    }

  </style>

{% endblock %}

{% block title %}: {% trans %}App Builder{% endtrans %}{% endblock %}

{% block body %}

  <div class="lightbox builder_embed">
    <iframe id="bulder_iframe" width="600px" height="400px"></iframe>
  </div>

{% endblock %}

{% block js %}

  <script>

    d3.select("iframe")
      .attr("src",window.location.href.replace("builder","embed"))

    dataviva.resize = function() {

      var width = window.innerWidth-40-d3plus.client.scrollbar(),
          height = window.innerHeight-157;

      if (height < 500) height = 500;

      d3.select("iframe")
        .attr("height",height+"px")
        .attr("width",width+"px")

    }

    dataviva.resize()

    if (Modernizr.history) {
      window.onpopstate = function() {
        var u = window.location.href.split("/builder/")[1].split("/?")[0]
        var app = document.getElementById("bulder_iframe").contentWindow.app
        if (app && u != app.url) app.start(u)
      }
    }

  </script>

{% endblock %}
